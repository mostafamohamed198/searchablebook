{"version":3,"file":"analytics.umd.min.js","sources":["../../src/utils.js","../../node_modules/cross-fetch/dist/browser-ponyfill.js","../../src/validate.js","../../src/index.js"],"sourcesContent":["// Function to parse the URL\nexport function getURL(url: string): string {\n  return url && url.trim() !== '' ? url : 'https://scalr.api.appbase.io';\n}\n\nexport function btoa(input = '') {\n  const chars =\n    'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n  const str = input;\n  let output = '';\n\n  // eslint-disable-next-line\n  for (\n    let block = 0, charCode, i = 0, map = chars;\n    str.charAt(i | 0) || ((map = '='), i % 1); // eslint-disable-line no-bitwise\n    output += map.charAt(63 & (block >> (8 - (i % 1) * 8))) // eslint-disable-line no-bitwise\n  ) {\n    charCode = str.charCodeAt((i += 3 / 4));\n\n    if (charCode > 0xff) {\n      throw new Error(\n        '\"btoa\" failed: The string to be encoded contains characters outside of the Latin1 range.'\n      );\n    }\n\n    block = (block << 8) | charCode; // eslint-disable-line no-bitwise\n  }\n\n  return output;\n}\n","var global = typeof self !== 'undefined' ? self : this;\nvar __self__ = (function () {\nfunction F() {\nthis.fetch = false;\nthis.DOMException = global.DOMException\n}\nF.prototype = global;\nreturn new F();\n})();\n(function(self) {\n\nvar irrelevant = (function (exports) {\n\n  var support = {\n    searchParams: 'URLSearchParams' in self,\n    iterable: 'Symbol' in self && 'iterator' in Symbol,\n    blob:\n      'FileReader' in self &&\n      'Blob' in self &&\n      (function() {\n        try {\n          new Blob();\n          return true\n        } catch (e) {\n          return false\n        }\n      })(),\n    formData: 'FormData' in self,\n    arrayBuffer: 'ArrayBuffer' in self\n  };\n\n  function isDataView(obj) {\n    return obj && DataView.prototype.isPrototypeOf(obj)\n  }\n\n  if (support.arrayBuffer) {\n    var viewClasses = [\n      '[object Int8Array]',\n      '[object Uint8Array]',\n      '[object Uint8ClampedArray]',\n      '[object Int16Array]',\n      '[object Uint16Array]',\n      '[object Int32Array]',\n      '[object Uint32Array]',\n      '[object Float32Array]',\n      '[object Float64Array]'\n    ];\n\n    var isArrayBufferView =\n      ArrayBuffer.isView ||\n      function(obj) {\n        return obj && viewClasses.indexOf(Object.prototype.toString.call(obj)) > -1\n      };\n  }\n\n  function normalizeName(name) {\n    if (typeof name !== 'string') {\n      name = String(name);\n    }\n    if (/[^a-z0-9\\-#$%&'*+.^_`|~]/i.test(name)) {\n      throw new TypeError('Invalid character in header field name')\n    }\n    return name.toLowerCase()\n  }\n\n  function normalizeValue(value) {\n    if (typeof value !== 'string') {\n      value = String(value);\n    }\n    return value\n  }\n\n  // Build a destructive iterator for the value list\n  function iteratorFor(items) {\n    var iterator = {\n      next: function() {\n        var value = items.shift();\n        return {done: value === undefined, value: value}\n      }\n    };\n\n    if (support.iterable) {\n      iterator[Symbol.iterator] = function() {\n        return iterator\n      };\n    }\n\n    return iterator\n  }\n\n  function Headers(headers) {\n    this.map = {};\n\n    if (headers instanceof Headers) {\n      headers.forEach(function(value, name) {\n        this.append(name, value);\n      }, this);\n    } else if (Array.isArray(headers)) {\n      headers.forEach(function(header) {\n        this.append(header[0], header[1]);\n      }, this);\n    } else if (headers) {\n      Object.getOwnPropertyNames(headers).forEach(function(name) {\n        this.append(name, headers[name]);\n      }, this);\n    }\n  }\n\n  Headers.prototype.append = function(name, value) {\n    name = normalizeName(name);\n    value = normalizeValue(value);\n    var oldValue = this.map[name];\n    this.map[name] = oldValue ? oldValue + ', ' + value : value;\n  };\n\n  Headers.prototype['delete'] = function(name) {\n    delete this.map[normalizeName(name)];\n  };\n\n  Headers.prototype.get = function(name) {\n    name = normalizeName(name);\n    return this.has(name) ? this.map[name] : null\n  };\n\n  Headers.prototype.has = function(name) {\n    return this.map.hasOwnProperty(normalizeName(name))\n  };\n\n  Headers.prototype.set = function(name, value) {\n    this.map[normalizeName(name)] = normalizeValue(value);\n  };\n\n  Headers.prototype.forEach = function(callback, thisArg) {\n    for (var name in this.map) {\n      if (this.map.hasOwnProperty(name)) {\n        callback.call(thisArg, this.map[name], name, this);\n      }\n    }\n  };\n\n  Headers.prototype.keys = function() {\n    var items = [];\n    this.forEach(function(value, name) {\n      items.push(name);\n    });\n    return iteratorFor(items)\n  };\n\n  Headers.prototype.values = function() {\n    var items = [];\n    this.forEach(function(value) {\n      items.push(value);\n    });\n    return iteratorFor(items)\n  };\n\n  Headers.prototype.entries = function() {\n    var items = [];\n    this.forEach(function(value, name) {\n      items.push([name, value]);\n    });\n    return iteratorFor(items)\n  };\n\n  if (support.iterable) {\n    Headers.prototype[Symbol.iterator] = Headers.prototype.entries;\n  }\n\n  function consumed(body) {\n    if (body.bodyUsed) {\n      return Promise.reject(new TypeError('Already read'))\n    }\n    body.bodyUsed = true;\n  }\n\n  function fileReaderReady(reader) {\n    return new Promise(function(resolve, reject) {\n      reader.onload = function() {\n        resolve(reader.result);\n      };\n      reader.onerror = function() {\n        reject(reader.error);\n      };\n    })\n  }\n\n  function readBlobAsArrayBuffer(blob) {\n    var reader = new FileReader();\n    var promise = fileReaderReady(reader);\n    reader.readAsArrayBuffer(blob);\n    return promise\n  }\n\n  function readBlobAsText(blob) {\n    var reader = new FileReader();\n    var promise = fileReaderReady(reader);\n    reader.readAsText(blob);\n    return promise\n  }\n\n  function readArrayBufferAsText(buf) {\n    var view = new Uint8Array(buf);\n    var chars = new Array(view.length);\n\n    for (var i = 0; i < view.length; i++) {\n      chars[i] = String.fromCharCode(view[i]);\n    }\n    return chars.join('')\n  }\n\n  function bufferClone(buf) {\n    if (buf.slice) {\n      return buf.slice(0)\n    } else {\n      var view = new Uint8Array(buf.byteLength);\n      view.set(new Uint8Array(buf));\n      return view.buffer\n    }\n  }\n\n  function Body() {\n    this.bodyUsed = false;\n\n    this._initBody = function(body) {\n      this._bodyInit = body;\n      if (!body) {\n        this._bodyText = '';\n      } else if (typeof body === 'string') {\n        this._bodyText = body;\n      } else if (support.blob && Blob.prototype.isPrototypeOf(body)) {\n        this._bodyBlob = body;\n      } else if (support.formData && FormData.prototype.isPrototypeOf(body)) {\n        this._bodyFormData = body;\n      } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n        this._bodyText = body.toString();\n      } else if (support.arrayBuffer && support.blob && isDataView(body)) {\n        this._bodyArrayBuffer = bufferClone(body.buffer);\n        // IE 10-11 can't handle a DataView body.\n        this._bodyInit = new Blob([this._bodyArrayBuffer]);\n      } else if (support.arrayBuffer && (ArrayBuffer.prototype.isPrototypeOf(body) || isArrayBufferView(body))) {\n        this._bodyArrayBuffer = bufferClone(body);\n      } else {\n        this._bodyText = body = Object.prototype.toString.call(body);\n      }\n\n      if (!this.headers.get('content-type')) {\n        if (typeof body === 'string') {\n          this.headers.set('content-type', 'text/plain;charset=UTF-8');\n        } else if (this._bodyBlob && this._bodyBlob.type) {\n          this.headers.set('content-type', this._bodyBlob.type);\n        } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n          this.headers.set('content-type', 'application/x-www-form-urlencoded;charset=UTF-8');\n        }\n      }\n    };\n\n    if (support.blob) {\n      this.blob = function() {\n        var rejected = consumed(this);\n        if (rejected) {\n          return rejected\n        }\n\n        if (this._bodyBlob) {\n          return Promise.resolve(this._bodyBlob)\n        } else if (this._bodyArrayBuffer) {\n          return Promise.resolve(new Blob([this._bodyArrayBuffer]))\n        } else if (this._bodyFormData) {\n          throw new Error('could not read FormData body as blob')\n        } else {\n          return Promise.resolve(new Blob([this._bodyText]))\n        }\n      };\n\n      this.arrayBuffer = function() {\n        if (this._bodyArrayBuffer) {\n          return consumed(this) || Promise.resolve(this._bodyArrayBuffer)\n        } else {\n          return this.blob().then(readBlobAsArrayBuffer)\n        }\n      };\n    }\n\n    this.text = function() {\n      var rejected = consumed(this);\n      if (rejected) {\n        return rejected\n      }\n\n      if (this._bodyBlob) {\n        return readBlobAsText(this._bodyBlob)\n      } else if (this._bodyArrayBuffer) {\n        return Promise.resolve(readArrayBufferAsText(this._bodyArrayBuffer))\n      } else if (this._bodyFormData) {\n        throw new Error('could not read FormData body as text')\n      } else {\n        return Promise.resolve(this._bodyText)\n      }\n    };\n\n    if (support.formData) {\n      this.formData = function() {\n        return this.text().then(decode)\n      };\n    }\n\n    this.json = function() {\n      return this.text().then(JSON.parse)\n    };\n\n    return this\n  }\n\n  // HTTP methods whose capitalization should be normalized\n  var methods = ['DELETE', 'GET', 'HEAD', 'OPTIONS', 'POST', 'PUT'];\n\n  function normalizeMethod(method) {\n    var upcased = method.toUpperCase();\n    return methods.indexOf(upcased) > -1 ? upcased : method\n  }\n\n  function Request(input, options) {\n    options = options || {};\n    var body = options.body;\n\n    if (input instanceof Request) {\n      if (input.bodyUsed) {\n        throw new TypeError('Already read')\n      }\n      this.url = input.url;\n      this.credentials = input.credentials;\n      if (!options.headers) {\n        this.headers = new Headers(input.headers);\n      }\n      this.method = input.method;\n      this.mode = input.mode;\n      this.signal = input.signal;\n      if (!body && input._bodyInit != null) {\n        body = input._bodyInit;\n        input.bodyUsed = true;\n      }\n    } else {\n      this.url = String(input);\n    }\n\n    this.credentials = options.credentials || this.credentials || 'same-origin';\n    if (options.headers || !this.headers) {\n      this.headers = new Headers(options.headers);\n    }\n    this.method = normalizeMethod(options.method || this.method || 'GET');\n    this.mode = options.mode || this.mode || null;\n    this.signal = options.signal || this.signal;\n    this.referrer = null;\n\n    if ((this.method === 'GET' || this.method === 'HEAD') && body) {\n      throw new TypeError('Body not allowed for GET or HEAD requests')\n    }\n    this._initBody(body);\n  }\n\n  Request.prototype.clone = function() {\n    return new Request(this, {body: this._bodyInit})\n  };\n\n  function decode(body) {\n    var form = new FormData();\n    body\n      .trim()\n      .split('&')\n      .forEach(function(bytes) {\n        if (bytes) {\n          var split = bytes.split('=');\n          var name = split.shift().replace(/\\+/g, ' ');\n          var value = split.join('=').replace(/\\+/g, ' ');\n          form.append(decodeURIComponent(name), decodeURIComponent(value));\n        }\n      });\n    return form\n  }\n\n  function parseHeaders(rawHeaders) {\n    var headers = new Headers();\n    // Replace instances of \\r\\n and \\n followed by at least one space or horizontal tab with a space\n    // https://tools.ietf.org/html/rfc7230#section-3.2\n    var preProcessedHeaders = rawHeaders.replace(/\\r?\\n[\\t ]+/g, ' ');\n    preProcessedHeaders.split(/\\r?\\n/).forEach(function(line) {\n      var parts = line.split(':');\n      var key = parts.shift().trim();\n      if (key) {\n        var value = parts.join(':').trim();\n        headers.append(key, value);\n      }\n    });\n    return headers\n  }\n\n  Body.call(Request.prototype);\n\n  function Response(bodyInit, options) {\n    if (!options) {\n      options = {};\n    }\n\n    this.type = 'default';\n    this.status = options.status === undefined ? 200 : options.status;\n    this.ok = this.status >= 200 && this.status < 300;\n    this.statusText = 'statusText' in options ? options.statusText : 'OK';\n    this.headers = new Headers(options.headers);\n    this.url = options.url || '';\n    this._initBody(bodyInit);\n  }\n\n  Body.call(Response.prototype);\n\n  Response.prototype.clone = function() {\n    return new Response(this._bodyInit, {\n      status: this.status,\n      statusText: this.statusText,\n      headers: new Headers(this.headers),\n      url: this.url\n    })\n  };\n\n  Response.error = function() {\n    var response = new Response(null, {status: 0, statusText: ''});\n    response.type = 'error';\n    return response\n  };\n\n  var redirectStatuses = [301, 302, 303, 307, 308];\n\n  Response.redirect = function(url, status) {\n    if (redirectStatuses.indexOf(status) === -1) {\n      throw new RangeError('Invalid status code')\n    }\n\n    return new Response(null, {status: status, headers: {location: url}})\n  };\n\n  exports.DOMException = self.DOMException;\n  try {\n    new exports.DOMException();\n  } catch (err) {\n    exports.DOMException = function(message, name) {\n      this.message = message;\n      this.name = name;\n      var error = Error(message);\n      this.stack = error.stack;\n    };\n    exports.DOMException.prototype = Object.create(Error.prototype);\n    exports.DOMException.prototype.constructor = exports.DOMException;\n  }\n\n  function fetch(input, init) {\n    return new Promise(function(resolve, reject) {\n      var request = new Request(input, init);\n\n      if (request.signal && request.signal.aborted) {\n        return reject(new exports.DOMException('Aborted', 'AbortError'))\n      }\n\n      var xhr = new XMLHttpRequest();\n\n      function abortXhr() {\n        xhr.abort();\n      }\n\n      xhr.onload = function() {\n        var options = {\n          status: xhr.status,\n          statusText: xhr.statusText,\n          headers: parseHeaders(xhr.getAllResponseHeaders() || '')\n        };\n        options.url = 'responseURL' in xhr ? xhr.responseURL : options.headers.get('X-Request-URL');\n        var body = 'response' in xhr ? xhr.response : xhr.responseText;\n        resolve(new Response(body, options));\n      };\n\n      xhr.onerror = function() {\n        reject(new TypeError('Network request failed'));\n      };\n\n      xhr.ontimeout = function() {\n        reject(new TypeError('Network request failed'));\n      };\n\n      xhr.onabort = function() {\n        reject(new exports.DOMException('Aborted', 'AbortError'));\n      };\n\n      xhr.open(request.method, request.url, true);\n\n      if (request.credentials === 'include') {\n        xhr.withCredentials = true;\n      } else if (request.credentials === 'omit') {\n        xhr.withCredentials = false;\n      }\n\n      if ('responseType' in xhr && support.blob) {\n        xhr.responseType = 'blob';\n      }\n\n      request.headers.forEach(function(value, name) {\n        xhr.setRequestHeader(name, value);\n      });\n\n      if (request.signal) {\n        request.signal.addEventListener('abort', abortXhr);\n\n        xhr.onreadystatechange = function() {\n          // DONE (success or failure)\n          if (xhr.readyState === 4) {\n            request.signal.removeEventListener('abort', abortXhr);\n          }\n        };\n      }\n\n      xhr.send(typeof request._bodyInit === 'undefined' ? null : request._bodyInit);\n    })\n  }\n\n  fetch.polyfill = true;\n\n  if (!self.fetch) {\n    self.fetch = fetch;\n    self.Headers = Headers;\n    self.Request = Request;\n    self.Response = Response;\n  }\n\n  exports.Headers = Headers;\n  exports.Request = Request;\n  exports.Response = Response;\n  exports.fetch = fetch;\n\n  Object.defineProperty(exports, '__esModule', { value: true });\n\n  return exports;\n\n})({});\n})(__self__);\n__self__.fetch.ponyfill = true;\n// Remove \"polyfill\" property added by whatwg-fetch\ndelete __self__.fetch.polyfill;\n// Choose between native implementation (global) or custom implementation (__self__)\n// var ctx = global.fetch ? global : __self__;\nvar ctx = __self__; // this line disable service worker support temporarily\nexports = ctx.fetch // To enable: import fetch from 'cross-fetch'\nexports.default = ctx.fetch // For TypeScript consumers without esModuleInterop.\nexports.fetch = ctx.fetch // To enable: import {fetch} from 'cross-fetch'\nexports.Headers = ctx.Headers\nexports.Request = ctx.Request\nexports.Response = ctx.Response\nmodule.exports = exports\n","export function validateIndex(index: string) {\n  if (!index) {\n    throw new Error(\n      'appbase-analytics: A valid index must be present to record analytics events.'\n    );\n  }\n}\n\nexport function validateCredentials(credentials: string) {\n  if (!credentials) {\n    throw new Error('appbase-analytics: Auth credentials is missing.');\n  }\n}\n\nexport function validateURL(url: string) {\n  if (!url) {\n    throw new Error('appbase-analytics: URL is missing.');\n  }\n}\n\nexport function validateSearchQuery(query: string) {\n  if (query === undefined || query === null) {\n    throw new Error(\n      'appbase-analytics: query must be present, set to empty string to register as an empty query search.'\n    );\n  }\n}\n\nexport function validateQuery(query: string, queryID: string) {\n  if ((query === undefined || query === null) && !queryID) {\n    throw new Error(\n      'appbase-analytics: query or queryID must be present to register a click/conversion event'\n    );\n  }\n}\n\nexport function validateQueryID(queryID: string) {\n  if (!queryID) {\n    throw new Error(\n      'appbase-analytics: queryID must be present to save search/favorite'\n    );\n  }\n}\n\nexport function validateClickObjects(objects: Object) {\n  if (!objects || Object.keys(objects).length < 1) {\n    throw new Error(\n      'appbase-analytics: at least one click object must be present to register a click event'\n    );\n  }\n}\n\nexport function validateConversionObjects(objects: Object) {\n  if (!objects || Object.keys(objects).length < 1) {\n    throw new Error(\n      'appbase-analytics: at least one click object must be present to register a click event'\n    );\n  }\n}\n","// @flow\nimport { btoa } from './utils';\nimport fetch from 'cross-fetch';\nimport {\n  validateIndex,\n  validateCredentials,\n  validateURL,\n  validateQuery,\n  validateClickObjects,\n  validateConversionObjects,\n  validateQueryID\n} from './validate';\n\ntype Hit = {\n  id?: string,\n  type?: string,\n  source?: Object\n};\n\ntype Impression = {\n  id: string,\n  index: 'good-books-ds'\n};\n\ntype AnalyticsConfig = {\n  index: string,\n  url: string,\n  credentials: string,\n  userID?: string,\n  globalCustomEvents?: { [key: string]: string },\n  headers?: Object\n};\n\ntype SearchConfig = {\n  query?: string,\n  queryID?: string,\n  customEvents?: { [key: string]: string },\n  filters?: { [key: string]: string },\n  hits?: Array<Hit>,\n  impressions?: Array<Impression>\n};\n\ntype SearchRequestBody = {\n  query?: string,\n  query_id?: string,\n  custom_events?: { [key: string]: string },\n  filters?: { [key: string]: string },\n  user_id?: string,\n  hits?: Array<Hit>\n};\n\ntype ClickConfig = {\n  query?: string,\n  queryID?: string,\n  isSuggestionClick?: boolean,\n  objects: { [key: string]: number },\n  customEvents?: { [key: string]: string },\n  meta?: Object\n};\n\ntype ClickRequestBody = {\n  click_on: { [key: string]: number },\n  click_type?: 'result' | 'suggestion',\n  query?: string,\n  query_id?: string,\n  custom_events?: { [key: string]: string },\n  user_id?: string,\n  meta?: Object\n};\n\ntype ConversionConfig = {\n  objects: Array<string>,\n  queryID?: string,\n  meta?: Object\n};\n\ntype SaveSearchConfig = {\n  queryID: string,\n  saveSearchID?: string,\n  saveSearchMeta?: Object,\n  userID?: string,\n  customEvents?: { [key: string]: string }\n};\n\ntype SaveSearchRequestBody = {\n  query_id: string,\n  save_search_id?: string,\n  save_search_meta?: Object,\n  user_id?: string,\n  custom_events?: { [key: string]: string }\n};\n\ntype FavoriteConfigRequest = {\n  favorite_on: string,\n  source: Object,\n  query_id: string,\n  id?: string,\n  custom_events?: { [key: string]: string },\n  user_id?: string,\n  meta?: Object\n};\n\ntype FavoriteConfig = {\n  favoriteOn: string,\n  source: Object,\n  queryID: string,\n  id?: string,\n  customEvents?: { [key: string]: string },\n  userID?: string,\n  meta?: Object\n};\n\ntype ConversionRequestBody = {\n  conversion_on: Array<string>,\n  query_id?: string,\n  meta?: Object\n};\n\ntype CallBack = (err: any, res: any) => void;\n\ntype Metrics = {\n  index: string,\n  url: string,\n  credentials: string,\n  globalCustomEvents?: { [key: string]: string },\n  userID?: string,\n  queryID: string,\n  headers?: Object,\n  search?: (searchConfig: SearchConfig, callback: CallBack) => void,\n  click?: (clickConfig: ClickConfig, callback: CallBack) => void,\n  conversion?: (conversionConfig: ConversionConfig, callback: CallBack) => void,\n  // To save search\n  saveSearch?: (saveSearchConfig: SaveSearchConfig, callback: CallBack) => void,\n  // To delete saved search\n  deleteSavedSearch?: (saveSearchId: string, callback: CallBack) => void,\n  // To retrieve saved searches\n  getSavedSearches?: (filters?: Object, callback: CallBack) => void,\n  // To record a favorite document\n  favorite?: (favoriteConfig: FavoriteConfig, callback: CallBack) => void,\n  // To retrieve favorites\n  getFavorites?: (filters?: Object, callback: CallBack) => void,\n  getQueryID?: () => string,\n  setUserID?: (userID: string) => void,\n  setGlobalCustomEvents?: (events: { [key: string]: string }) => void,\n  setHeaders?: (headers: Object) => void,\n  _request: (\n    method: string,\n    url: string,\n    body?: Object,\n    queryParams?: Object,\n    callback?: CallBack\n  ) => void\n};\n\nfunction initClient(config: AnalyticsConfig = {}) {\n  const metrics: Metrics = {\n    credentials: config.credentials,\n    index: config.index,\n    url: config.url,\n    userID: config.userID,\n    globalCustomEvents: config.globalCustomEvents,\n    queryID: '',\n    headers: null,\n    _request: (\n      method: string,\n      url: string,\n      body?: Object,\n      queryParams?: Object,\n      callback?: CallBack\n    ): void => {\n      const finalBody = {\n        user_id: metrics.userID,\n        ...body,\n        custom_events: {\n          ...(body && body.custom_events),\n          ...metrics.globalCustomEvents\n        }\n      };\n      let queryParamsString = '';\n      if (queryParams) {\n        queryParamsString = Object.keys(queryParams)\n          .map(param => `${param}=${queryParams[param]}`)\n          .join('&');\n      }\n      return fetch(`${metrics.url}/${url}?${queryParamsString}`, {\n        method: method,\n        headers: {\n          ...metrics.headers,\n          'Content-Type': 'application/json',\n          Authorization: `Basic ${btoa(metrics.credentials)}`\n        },\n        body: method === 'GET' ? null : JSON.stringify(finalBody)\n      })\n        .then(response => {\n          if (callback) {\n            callback(null, response);\n          }\n        })\n        .catch(err => {\n          if (callback) {\n            callback(err, null);\n          }\n        });\n    }\n  };\n\n  validateIndex(metrics.index);\n  validateCredentials(metrics.credentials);\n  validateURL(metrics.url);\n\n  // To register a search\n  metrics.search = (searchConfig: SearchConfig, callback?: CallBack) => {\n    validateQuery(searchConfig.query, searchConfig.queryID);\n    const captureQueryID = (err: any, res: any) => {\n      if (res) {\n        res\n          .json()\n          .then(response => {\n            if (response && response.query_id) {\n              metrics.queryID = response.query_id;\n            }\n            if (callback) {\n              callback(err, res);\n            }\n          })\n          .catch(err2 => {\n            if (callback) {\n              callback(err2, res);\n            }\n          });\n      } else if (callback) {\n        callback(err, res);\n      }\n    };\n    // just to avoid the flow type error\n    if (metrics._request) {\n      const requestBody: SearchRequestBody = {\n        query: searchConfig.query,\n        query_id: searchConfig.queryID,\n        custom_events: searchConfig.customEvents,\n        filters: searchConfig.filters,\n        hits: searchConfig.hits,\n        impressions: searchConfig.impressions\n      };\n      metrics._request(\n        'PUT',\n        `${metrics.index}/_analytics/search`,\n        requestBody,\n        null,\n        captureQueryID\n      );\n    }\n  };\n\n  // To register a click\n  metrics.click = (clickConfig: ClickConfig, callback?: CallBack) => {\n    validateQuery(clickConfig.query, clickConfig.queryID);\n    validateClickObjects(clickConfig.objects);\n    // just to avoid the flow type error\n    if (metrics._request) {\n      const requestBody: ClickRequestBody = {\n        click_on: clickConfig.objects,\n        click_type: clickConfig.isSuggestionClick ? 'suggestion' : 'result',\n        query: clickConfig.query,\n        query_id: clickConfig.queryID,\n        custom_events: clickConfig.customEvents,\n        meta: clickConfig.meta\n      };\n      metrics._request(\n        'PUT',\n        `${metrics.index}/_analytics/click`,\n        requestBody,\n        null,\n        callback\n      );\n    }\n  };\n\n  // To register a conversion\n  metrics.conversion = (\n    conversionConfig: ConversionConfig,\n    callback?: CallBack\n  ) => {\n    validateQuery(null, conversionConfig.queryID);\n    validateConversionObjects(conversionConfig.objects);\n    // just to avoid the flow type error\n    if (metrics._request) {\n      const requestBody: ConversionRequestBody = {\n        conversion_on: conversionConfig.objects,\n        query_id: conversionConfig.queryID,\n        meta: conversionConfig.meta\n      };\n      metrics._request(\n        'PUT',\n        `${metrics.index}/_analytics/conversion`,\n        requestBody,\n        null,\n        callback\n      );\n    }\n  };\n\n  // To save search\n  metrics.saveSearch = (\n    saveSearchConfig: SaveSearchConfig,\n    callback?: CallBack\n  ) => {\n    validateQueryID(saveSearchConfig.queryID);\n    const requestBody: SaveSearchRequestBody = {\n      query_id: saveSearchConfig.queryID,\n      save_search_id: saveSearchConfig.saveSearchID,\n      save_search_meta: saveSearchConfig.saveSearchMeta,\n      user_id: saveSearchConfig.userID,\n      custom_events: saveSearchConfig.customEvents\n    };\n    metrics._request(\n      'PUT',\n      '_analytics/save-search',\n      requestBody,\n      null,\n      callback\n    );\n  };\n\n  // To delete save search\n  metrics.deleteSavedSearch = (saveSearchId: string, callback?: CallBack) => {\n    metrics._request(\n      'DELETE',\n      '_analytics/save-search/' + saveSearchId,\n      null,\n      null,\n      callback\n    );\n  };\n\n  // To retrieve saved searches\n  metrics.getSavedSearches = (filters?: Object, callback?: CallBack) => {\n    // just to avoid the flow type error\n    if (metrics._request) {\n      metrics._request(\n        'GET',\n        '_analytics/saved-searches',\n        null,\n        filters,\n        callback\n      );\n    }\n  };\n\n  // To record a favorite document\n  metrics.favorite = (favoriteConfig: FavoriteConfig, callback?: CallBack) => {\n    validateQueryID(favoriteConfig.queryID);\n    if (!favoriteConfig.favoriteOn || favoriteConfig.favoriteOn === '') {\n      throw new Error('appbase-analytics: favoriteOn property is required');\n    }\n    if (!favoriteConfig.source) {\n      throw new Error('appbase-analytics: source property is required');\n    }\n    const requestBody: FavoriteConfigRequest = {\n      query_id: favoriteConfig.queryID,\n      favorite_on: favoriteConfig.favoriteOn,\n      source: favoriteConfig.source,\n      id: favoriteConfig.id,\n      meta: favoriteConfig.meta,\n      user_id: favoriteConfig.userID,\n      custom_events: favoriteConfig.customEvents\n    };\n    metrics._request('PUT', '_analytics/favorite', requestBody, null, callback);\n  };\n\n  // To retrieve favorites\n  metrics.getFavorites = (filters?: Object, callback?: CallBack) => {\n    // just to avoid the flow type error\n    if (metrics._request) {\n      metrics._request('GET', '_analytics/favorites', null, filters, callback);\n    }\n  };\n\n  // Sets the userID\n  metrics.setUserID = (userID: string) => {\n    metrics.userID = userID;\n  };\n\n  // Sets the global events\n  metrics.setGlobalCustomEvents = (globalEvents: { [key: string]: string }) => {\n    metrics.globalCustomEvents = globalEvents;\n  };\n\n  // Sets the headers\n  metrics.setHeaders = (headers: Object) => {\n    metrics.headers = headers;\n  };\n\n  // get queryID\n  metrics.getQueryID = () => metrics.queryID;\n\n  return metrics;\n}\n\nexport default {\n  init: initClient\n};\n"],"names":["btoa","input","charCode","str","output","block","i","map","charAt","charCodeAt","Error","global","self","this","__self__","F","fetch","DOMException","prototype","exports","support","Symbol","Blob","e","viewClasses","isArrayBufferView","ArrayBuffer","isView","obj","indexOf","Object","toString","call","normalizeName","name","String","test","TypeError","toLowerCase","normalizeValue","value","iteratorFor","items","iterator","next","shift","done","undefined","Headers","headers","forEach","append","Array","isArray","header","getOwnPropertyNames","consumed","body","bodyUsed","Promise","reject","fileReaderReady","reader","resolve","onload","result","onerror","error","readBlobAsArrayBuffer","blob","FileReader","promise","readAsArrayBuffer","bufferClone","buf","slice","view","Uint8Array","byteLength","set","buffer","Body","_initBody","_bodyInit","_bodyText","isPrototypeOf","_bodyBlob","FormData","_bodyFormData","URLSearchParams","DataView","_bodyArrayBuffer","get","type","rejected","arrayBuffer","then","text","readAsText","chars","length","fromCharCode","join","readArrayBufferAsText","formData","decode","json","JSON","parse","oldValue","has","hasOwnProperty","callback","thisArg","keys","push","values","entries","methods","Request","options","method","upcased","url","credentials","mode","signal","toUpperCase","referrer","form","trim","split","bytes","replace","decodeURIComponent","Response","bodyInit","status","ok","statusText","clone","response","redirectStatuses","redirect","RangeError","location","err","message","stack","create","constructor","init","request","aborted","xhr","XMLHttpRequest","abortXhr","abort","rawHeaders","getAllResponseHeaders","line","parts","key","responseURL","responseText","ontimeout","onabort","open","withCredentials","responseType","setRequestHeader","addEventListener","onreadystatechange","readyState","removeEventListener","send","polyfill","defineProperty","ponyfill","ctx","module","validateQuery","query","queryID","validateQueryID","config","metrics","index","userID","globalCustomEvents","_request","queryParams","finalBody","user_id","custom_events","queryParamsString","param","Authorization","stringify","validateIndex","validateCredentials","validateURL","search","searchConfig","requestBody","query_id","customEvents","filters","hits","impressions","res","err2","click","clickConfig","objects","validateClickObjects","click_on","click_type","isSuggestionClick","meta","conversion","conversionConfig","validateConversionObjects","conversion_on","saveSearch","saveSearchConfig","save_search_id","saveSearchID","save_search_meta","saveSearchMeta","deleteSavedSearch","saveSearchId","getSavedSearches","favorite","favoriteConfig","favoriteOn","source","favorite_on","id","getFavorites","setUserID","setGlobalCustomEvents","globalEvents","setHeaders","getQueryID"],"mappings":"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"}