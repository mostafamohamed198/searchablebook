"use strict";var SearchkitDefault=(()=>{var Y=Object.create;var _=Object.defineProperty;var Z=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames;var q=Object.getPrototypeOf,ee=Object.prototype.hasOwnProperty;var te=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),re=(t,e)=>{for(var r in e)_(t,r,{get:e[r],enumerable:!0})},$=(t,e,r,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of X(e))!ee.call(t,n)&&n!==r&&_(t,n,{get:()=>e[n],enumerable:!(s=Z(e,n))||s.enumerable});return t};var se=(t,e,r)=>(r=t!=null?Y(q(t)):{},$(e||!t||!t.__esModule?_(r,"default",{value:t,enumerable:!0}):r,t)),ne=t=>$(_({},"__esModule",{value:!0}),t);var T=te((ke,j)=>{"use strict";var ie=function(e){return ae(e)&&!oe(e)};function ae(t){return!!t&&typeof t=="object"}function oe(t){var e=Object.prototype.toString.call(t);return e==="[object RegExp]"||e==="[object Date]"||le(t)}var ue=typeof Symbol=="function"&&Symbol.for,ce=ue?Symbol.for("react.element"):60103;function le(t){return t.$$typeof===ce}function ge(t){return Array.isArray(t)?[]:{}}function F(t,e){return e.clone!==!1&&e.isMergeableObject(t)?b(ge(t),t,e):t}function fe(t,e,r){return t.concat(e).map(function(s){return F(s,r)})}function pe(t,e){if(!e.customMerge)return b;var r=e.customMerge(t);return typeof r=="function"?r:b}function he(t){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(t).filter(function(e){return t.propertyIsEnumerable(e)}):[]}function v(t){return Object.keys(t).concat(he(t))}function O(t,e){try{return e in t}catch{return!1}}function de(t,e){return O(t,e)&&!(Object.hasOwnProperty.call(t,e)&&Object.propertyIsEnumerable.call(t,e))}function ye(t,e,r){var s={};return r.isMergeableObject(t)&&v(t).forEach(function(n){s[n]=F(t[n],r)}),v(e).forEach(function(n){de(t,n)||(O(t,n)&&r.isMergeableObject(e[n])?s[n]=pe(n,r)(t[n],e[n],r):s[n]=F(e[n],r))}),s}function b(t,e,r){r=r||{},r.arrayMerge=r.arrayMerge||fe,r.isMergeableObject=r.isMergeableObject||ie,r.cloneUnlessOtherwiseSpecified=F;var s=Array.isArray(e),n=Array.isArray(t),a=s===n;return a?s?r.arrayMerge(t,e,r):ye(t,e,r):F(e,r)}b.all=function(e,r){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce(function(s,n){return b(s,n,r)},{})};var me=b;j.exports=me});var je={};re(je,{ESTransporter:()=>Q,default:()=>E});var z=se(T());var y=(t,e)=>t.find(s=>typeof s=="string"?s===e:s.attribute===e)||e,S=t=>typeof t!="string"&&!!t.nestedPath;var k=t=>typeof t=="string"?t:t.attribute,N=(t,e)=>{var s;let r=typeof e=="string"?e:e.attribute;return t.includes(r)?"string":((s=t.find(n=>(n==null?void 0:n.attribute)===r))==null?void 0:s.type)||"string"},x=t=>t.reduce((e,r)=>[...e,JSON.stringify({index:r.indexName}),`
`,JSON.stringify(r.body),`
`],[]).join("");var B=(t,e)=>{let{params:r={}}=t,{numericFilters:s}=r;return Array.isArray(s)?s.reduce((n,a)=>{let[i,g,c,o]=a.match(/([\w\.\_\-]+)(\=|\!\=|\>|\>\=|\<|\<\=)(\d+)/),u=w(e.facet_attributes||[],e.filter_attributes||[])[g];if(!i)return n;let f=(p,d,m)=>{if(d==="=")return{term:{[p]:m}};if(d==="!=")return{bool:{must_not:{term:{[p]:m}}}};if(d===">")return{range:{[p]:{gt:m}}};if(d===">=")return{range:{[p]:{gte:m}}};if(d==="<")return{range:{[p]:{lt:m}}};if(d==="<=")return{range:{[p]:{lte:m}}}},h=[];if(u.nestedPath){let p=n.find(d=>d.nested.path===u.nestedPath);p?p.nested.query.bool.filter.push(f(u.nestedPath+"."+u.field,c,o)):h.push({nested:{path:u.nestedPath,inner_hits:{},query:{bool:{filter:[f(u.nestedPath+"."+u.field,c,o)]}}}})}else h.push(f(u.field,c,o));return[...n,...h]},[]):[]},A=(t,e)=>({term:{[t]:e}}),w=(t,e)=>[...e,...t].reduce((r,s)=>{let n=typeof s=="string"?{attribute:s,field:s,type:"string"}:s;return{...r,[n.attribute]:n}},{}),I=(t,e)=>{let{params:r={}}=t,{facetFilters:s}=r;if(!Array.isArray(s))return[];let n=w(e.facet_attributes||[],e.filter_attributes||[]);return s.reduce((a,i)=>{if(Array.isArray(i))return[...a,{bool:{should:i.reduce((g,c)=>{let[o,l]=c.split(":"),u=n[o];if(!u)throw new Error(`Facet "${o}" not found in configuration. Add configuration to either facet_attributes or filter_attributes.`);let f=u.field;if(S(u)){let h=g.find(p=>p.nested&&p.nested.path===u.nestedPath);return h?(h.nested.query.bool.should.push(A(`${u.nestedPath}.${u.field}`,l)),g):[...g,{nested:{inner_hits:{},path:u.nestedPath,query:{bool:{should:[A(`${u.nestedPath}.${u.field}`,l)]}}}}]}return[...g,A(f,l)]},[])}}];if(typeof i=="string"){let[g,c]=i.split(":"),o=k(g),l=y(e.facet_attributes||[],o),u=typeof l=="string"?l:l.field;if(typeof l!="string"&&S(l)&&l.nestedPath){let f=a.find(h=>h.nested&&h.nested.path===l.nestedPath+".");return f?(f.nested.query.bool.should.push(A(`${l.nestedPath}.${l.field}`,c)),a):[...a,{nested:{inner_hits:{},path:l.nestedPath,query:{bool:{should:[A(`${l.nestedPath}.${l.field}`,c)]}}}}]}return[...a,A(u,c)]}},[])},C=(t=[],e=[],r)=>{let s=/([\w\.\-]+)\:/gi,n=w(t,e);return r.replace(s,(a,i)=>{if(!n[i])throw new Error(`Attribute "${i}" is not defined as an attribute in the facet or filter search settings`);if(n[i].nestedPath)throw new Error(`Attribute "${i}" is a nested field and cannot be used as a filter. Nested fields are supported in facetFilers or numericFilters.`);return n[i].field+":"})},D=(t,e)=>{let{params:r={}}=t,{filters:s}=r;return!s||s===""?[]:[{query_string:{query:C(e.facet_attributes,e.filter_attributes,s)}}]},H=(t,e)=>{if(!e.geo_attribute)return[];let{params:r={}}=t,{aroundLatLng:s,aroundRadius:n,insideBoundingBox:a}=r;if(a)return[be(a,e.geo_attribute)];if(s){let i=s.split(",");return[{geo_distance:{distance:n||"1000m",[e.geo_attribute]:{lat:i[0],lon:i[1]}}}]}return[]};function be(t,e){let r=(s,n,a,i)=>({geo_bounding_box:{[e]:{top_right:{lat:s,lon:n},bottom_left:{lat:a,lon:i}}}});if(typeof t=="string"){let[s,n,a,i]=t.split(",");return r(parseFloat(s),parseFloat(n),parseFloat(a),parseFloat(i))}else if(Array.isArray(t))return{bool:{should:t.map(n=>{let[a,i,g,c]=n;return r(parseFloat(a),parseFloat(i),parseFloat(g),parseFloat(c))})}}}function L(t,e){if(e.sorting&&Object.keys(e.sorting).length>0){let r=Object.keys(e.sorting).find(n=>{if(t.indexName.endsWith(n))return!0});if(!r&&!e.sorting.default)return{};let s=r?e.sorting[r]:e.sorting.default;return Array.isArray(s)?{sort:s.map(n=>({[n.field]:n.order}))}:{sort:{[s.field]:s.order}}}return{}}function W(t,e){if(e.sorting&&Object.keys(e.sorting).length>0){let r=Object.keys(e.sorting).find(s=>{if(t.endsWith(s))return!0});if(r)return t.replace(r,"")}return t}var Ae=t=>{let e=t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");return e=e.split("").map(r=>/[a-z]/.test(r)?`[${r}${r.toUpperCase()}]`:r).join(""),e=`${e}.*`,t.length>2&&(e=`([a-zA-Z]+ )+?${e}`),e},P=(t,e,r)=>{let s=r&&r.length>0?{include:Ae(r)}:{},n={},a=(i,g)=>(typeof t=="string"||t.type==="string"?n={[i]:{terms:{field:g,size:e,...s}}}:t.type==="numeric"&&(n={[i+"$_stats"]:{stats:{field:g}},[i+"$_entries"]:{terms:{field:g,size:e}}}),n);return typeof t=="string"?a(t,t):S(t)?{[`${t.nestedPath}.`]:{nested:{path:t.nestedPath},aggs:a(t.attribute,`${t.nestedPath}.${t.field}`)}}:a(t.attribute,t.field)},Fe=(t,e,r)=>{let{params:s={},type:n}=t,{facets:a,maxValuesPerFacet:i,facetName:g,facetQuery:c}=s,o=i||10,l=e.facet_attributes||[];if(g)return P(y(l,g),o,c);if(Array.isArray(a)){let u=e.facet_attributes||[];return r.facetAttributesOrder&&(u=r.facetAttributesOrder.map(h=>y(e.facet_attributes||[],h))),(a[0]==="*"?u:a.map(h=>y(e.facet_attributes||[],h))).reduce((h,p)=>(0,z.default)(h,P(p,o,"")),{})||{}}else if(typeof a=="string"){let u=y(e.facet_attributes||[],a);return P(u,o,"")}};function Se(t,e){return e.touched?{function_score:{query:{pinned:{ids:e.pinnedDocs,organic:t}},functions:e.boostFunctions}}:t}function Qe(t,e){let r=s=>e.map(n=>typeof n=="string"?n:`${n.field}^${(n.weight||1)*s}`);return{bool:{should:[{bool:{should:[{multi_match:{query:t,fields:r(1),fuzziness:"AUTO:4,8"}},{multi_match:{query:t,fields:r(.5),type:"bool_prefix"}}]}},{multi_match:{query:t,type:"phrase",fields:r(2)}}]}}}var _e=(t,e,r,s)=>{var c;let n=r.query,a=e.search_attributes,i=[...I(t,e),...B(t,e),...D(t,e),...H(t,e),...((c=s==null?void 0:s.getBaseFilters)==null?void 0:c.call(s))||[],...r.baseFilters],g=typeof n=="string"&&n!==""?s!=null&&s.getQuery?s.getQuery(n,a,e):Qe(n,a):{match_all:{}};return{bool:{filter:i,must:r.touched?Se(g,r):g}}},xe=(t,e)=>{let{params:r={}}=t,s=r.hitsPerPage==null?20:r.hitsPerPage;return{size:s,from:(r.page||0)*s}},Ce=(t,e)=>{let{params:r={}}=t,{attributesToRetrieve:s}=r,n=new Set([...e.result_attributes||[],...e.highlight_attributes||[],...e.geo_attribute?[e.geo_attribute]:[]]);return{_source:{includes:Array.from(n)}}},Ee=(t,e)=>{var i,g;let{params:r={}}=t,{attributesToHighlight:s}=r,n=((i=e.highlight_attributes)==null?void 0:i.reduce((c,o)=>({...c,[o]:{number_of_fragments:0}}),{}))||{},a=((g=e.snippet_attributes)==null?void 0:g.reduce((c,o)=>({...c,[o]:{number_of_fragments:5,fragment_size:100}}),{}))||{};return{highlight:{pre_tags:["<em>"],post_tags:["</em>"],fields:{...n,...a}}}};function J(t,e,r,s){return{aggs:Fe(t,e,r),query:_e(t,e,r,s),...xe(t,e),...Ce(t,e),...Ee(t,e),...L(t,e)}}function U(t,e){let r=new RegExp(e,"gi");return t.replace(r,s=>`<em>${s}</em>`)}function R(t,e="<ais-highlight-0000000000>",r="<ais-highlight-0000000000/>",s=[]){let{_source:n={},highlight:a={}}=t,i={...n,...a};return Object.keys(i).reduce((c,o)=>{let l=n[o],u=a[o]||null;if(!s.includes(o)&&s[0]!=="*")return c;if(Array.isArray(l)&&!u)return{...c,[o]:l.map(f=>({matchLevel:"none",matchedWords:[],value:f.toString()}))};if(Array.isArray(l)&&u&&Array.isArray(u))return{...c,[o]:u.map(f=>({fullyHighlighted:!1,matchLevel:"full",matchedWords:Array.from(f.matchAll(/\<em\>(.*?)\<\/em\>/g)).map(p=>p[1]),value:f.toString().replace(/\<em\>/g,e).replace(/\<\/em\>/g,r)}))};if(!Array.isArray(l)&&u&&Array.isArray(u)||!l&&Array.isArray(u)&&u.length>0){let f=u[0],p={fullyHighlighted:!1,matchLevel:"full",matchedWords:Array.from(f.matchAll(/\<em\>(.*?)\<\/em\>/g)).map(d=>d[1]),value:f.toString().replace(/\<em\>/g,e).replace(/\<\/em\>/g,r)};return{...c,[o]:p}}return{...c,[o]:{matchLevel:"none",matchedWords:[],value:l!=null?l.toString():""}}},{})}var we=(t,e,r)=>{let{hits:s}=t,{highlight_attributes:n=[],snippet_attributes:a=[]}=e;return s.hits.map(i=>{var g,c,o,l,u,f;return{objectID:i._id,...i._source||{},...i.inner_hits?{inner_hits:i.inner_hits}:{},...n.length>0?{_highlightResult:R(i,(g=r==null?void 0:r.params)==null?void 0:g.highlightPreTag,(c=r==null?void 0:r.params)==null?void 0:c.highlightPostTag,n)}:{},...a.length>0?{_snippetResult:R(i,(o=r==null?void 0:r.params)==null?void 0:o.highlightPreTag,(l=r==null?void 0:r.params)==null?void 0:l.highlightPostTag,e.snippet_attributes)}:{},...e.geo_attribute&&((u=i._source)==null?void 0:u[e.geo_attribute])?{_geoloc:Pe((f=i._source)==null?void 0:f[e.geo_attribute])}:{}}})};function Pe(t){if(typeof t=="string"){let[e,r]=t.split(",").map(s=>parseFloat(s));return{lat:e,lng:r}}else{if(Array.isArray(t))return{lat:t[0],lng:t[1]};if(typeof t=="object"&&"lat"in t&&"lon"in t)return{lat:parseFloat(t.lat),lng:parseFloat(t.lon)}}return null}var Re=(t,e)=>{if(!(t!=null&&t.aggregations))return{};let r=Object.keys(t.aggregations).reduce((s,n)=>{let a=(t.aggregations||{})[n];if(n.endsWith(".")){let{doc_count:i,...g}=a;return{...s,...g}}return{...s,[n]:a}},{});return Object.keys(r).reduce((s,n)=>{let a=n.split("$")[0];if(N(e.facet_attributes||[],a)==="numeric"){let c=r[a+"$_stats"],{buckets:o}=r[a+"$_entries"];return{...s,facets:{...s.facets,[a]:o.reduce((l,u)=>({...l,[u.key]:u.doc_count}),{})},facets_stats:{...s.facets_stats,[a]:{min:c.min,avg:c.avg,max:c.max,sum:c.sum}}}}let{buckets:g}=r[a];return{...s,facets:{...s.facets,[a]:g.reduce((c,o)=>({...c,[o.key]:o.doc_count}),{})}}},{facets:{},facets_stats:{}})},Me=(t,e)=>{var s,n;let r=(s=t.facet_attributes)==null?void 0:s.map(a=>typeof a=="string"?a:a.attribute);return{renderingContent:{facetOrdering:{facets:{order:e.facetAttributesOrder||r||[]},values:(n=t.facet_attributes)==null?void 0:n.reduce((a,i)=>{let g=typeof i=="string"?i:i.attribute;return e.facetAttributesOrder&&!e.facetAttributesOrder.includes(g)?a:{...a,[g]:{sortRemainingBy:"count"}}},{})}}}},$e=(t,e,r)=>{let{params:s={}}=e,{hitsPerPage:n=20,page:a=0}=s,{total:i}=t.hits,g=typeof i=="number"?i:i==null?void 0:i.value,c=n<=0?0:Math.ceil((typeof i=="number"?i:(i==null?void 0:i.value)||0)/n);return{hitsPerPage:n,processingTimeMS:t.took,nbHits:g,page:a,nbPages:c,query:r.query}};function M(t,e,r,s){try{return{appliedRules:s.ruleIds,exhaustiveNbHits:!0,exhaustiveFacetsCount:!0,exhaustiveTypo:!0,exhaustive:{facetsCount:!0,nbHits:!0,typo:!0},...$e(t,e,s),...Me(r,s),...Re(t,r),hits:we(t,r,e),index:e.indexName,params:new URLSearchParams(e.params).toString(),...s.userData.length>0?{userData:s.userData}:{}}}catch{throw new Error("Error transforming Elasticsearch response for index")}}var V=(t,e)=>{var g,c,o;let r=t.aggregations||{},s=(g=e==null?void 0:e.params)==null?void 0:g.facetName,n=((c=e.params)==null?void 0:c.highlightPreTag)||"<ais-highlight-0000000000>",a=((o=e.params)==null?void 0:o.highlightPostTag)||"<ais-highlight-0000000000/>",i=r[Object.keys(r)[0]];return i&&i[s]&&(i=i[s]),{facetHits:i.buckets.map(l=>({value:l.key,highlighted:U(l.key,e.params.facetQuery||"").replace(/<\em>/g,n).replace(/<\/\em>/g,a),count:l.doc_count})),exhaustiveFacetsCount:!0,processingTimeMS:t.took}};var ve=t=>typeof btoa>"u"?Buffer.from(t.username+":"+t.password).toString("base64"):btoa(t.username+":"+t.password),Q=class{constructor(e,r){this.config=e;this.settings=r}createElasticsearchQueryFromRequest(e){return x(e)}async performNetworkRequest(e){return fetch(`${this.config.host}/_msearch`,{headers:{...this.config.apiKey?{authorization:`ApiKey ${this.config.apiKey}`}:{},"content-type":"application/json",...this.config.headers||{},...this.config.auth?{Authorization:"Basic "+ve(this.config.auth)}:{}},body:this.createElasticsearchQueryFromRequest(e),method:"POST"})}async msearch(e){var r,s,n,a,i,g;try{let o=await(await this.performNetworkRequest(e)).json();if(this.settings.debug&&(console.log("Elasticsearch response:"),console.log(JSON.stringify(o))),o.status>=500)throw console.error(JSON.stringify(o)),new Error("Elasticsearch Internal Error: Check your elasticsearch instance to make sure it can recieve requests.");if(o.status===401)throw console.error(JSON.stringify(o)),new Error("Cannot connect to Elasticsearch. Check your connection host and auth details (username/password or API Key required). You can also provide a custom Elasticsearch transporter to the API Client. See https://www.searchkit.co/docs/guides/setup-elasticsearch#connecting-with-usernamepassword for more details.");if(((s=(r=o.responses)==null?void 0:r[0])==null?void 0:s.status)===403)throw console.error(JSON.stringify(o)),new Error("Auth Error: You do not have permission to access this index. Check you are calling the right index (specified in frontend) and your API Key permissions has access to the index.");if(o.status===404||((a=(n=o.responses)==null?void 0:n[0])==null?void 0:a.status)===404)throw console.error(JSON.stringify(o)),new Error("Elasticsearch index not found. Check your index name and make sure it exists.");if(o.status===400||((g=(i=o.responses)==null?void 0:i[0])==null?void 0:g.status)===400)throw console.error(JSON.stringify(o)),new Error(`Elasticsearch Bad Request. 
          
          1. Check your query and make sure it is valid. 
          2. Check the field mapping. See documentation to make sure you are using text types for searching and keyword fields for faceting
          3. Turn on debug mode to see the Elasticsearch query and the error response.
          `);return o.responses}catch(c){throw c}}};var G=t=>{if(!t)return[];if(typeof t=="string"){let[e,r]=t.split(":");return[{attribute:e,value:r}]}else return t.reduce((e,r)=>{if(typeof r=="string"){let[s,n]=r.split(":");return[...e,{attribute:s,value:n}]}return[...e,...G(r)]},[])},K=(t,e,r)=>{var i,g,c;let s={query:((i=e.params)==null?void 0:i.query)||"",context:((g=e.params)==null?void 0:g.ruleContexts)||[],filters:G((c=e.params)==null?void 0:c.facetFilters)},n=Oe(s,t||[]);return n.reduce((o,l)=>(l.actions.map(u=>{o.touched=!0,u.action==="PinnedResult"?o.pinnedDocs.push(...u.documentIds):u.action==="QueryRewrite"?o.query=u.query:u.action==="QueryBoost"?o.boostFunctions.push({filter:{query_string:{query:C(r.facet_attributes,r.filter_attributes,u.query)}},weight:u.weight}):u.action==="RenderUserData"?o.userData.push(JSON.parse(u.userData)):u.action==="RenderFacetsOrder"?o.facetAttributesOrder=u.facetAttributesOrder:u.action==="QueryFilter"&&o.baseFilters.push({query_string:{query:C(r.facet_attributes,r.filter_attributes,u.query)}})}),o),{ruleIds:n.map(o=>o.id),pinnedDocs:[],boostFunctions:[],query:s.query,userData:[],facetAttributesOrder:void 0,touched:!1,baseFilters:[]})},Oe=(t,e)=>e.filter(r=>r.conditions.find(s=>s.filter(n=>n.context==="query"&&n.match_type==="exact"?n.value===t.query:n.context==="query"&&n.match_type==="contains"?t.query.includes(n.value):n.context==="query"&&n.match_type==="prefix"?t.query.startsWith(n.value):n.context==="context"?n.value.some(a=>t.context.includes(a)):n.context==="filterPresent"?n.values.every(a=>t.filters.find(i=>i.attribute===a.attribute&&i.value===a.value)!==void 0):!1).length===s.length)!==void 0);var E=class{constructor(e,r={debug:!1}){this.config=e;this.settings=r;this.transporter="msearch"in e.connection?e.connection:new Q(e.connection,r)}async performSearch(e){try{return this.settings.debug&&(console.log("Performing search with requests:"),console.log("POST /_msearch"),console.log(x(e))),await this.transporter.msearch(e)}catch(r){return console.error(r),[]}}async handleInstantSearchRequests(e,r){var c,o;let s=this.config.search_settings.query_rules||[],n=e.map(l=>K(s,l,this.config.search_settings)),a=e.map((l,u)=>({body:J(l,this.config.search_settings,n[u],r),request:l,indexName:W(l.indexName,this.config.search_settings)}));(c=r==null?void 0:r.hooks)!=null&&c.beforeSearch&&(a=await r.hooks.beforeSearch(a));let i=await this.performSearch(a);return(o=r==null?void 0:r.hooks)!=null&&o.afterSearch&&(i=await r.hooks.afterSearch(a,i)),{results:i.map((l,u)=>{var f;return(f=e[u].params)!=null&&f.facetName?V(l,e[u]):M(l,e[u],this.config.search_settings,n[u])})}}};return ne(je);})();
var Searchkit = SearchkitDefault.default
//# sourceMappingURL=index.global.js.map