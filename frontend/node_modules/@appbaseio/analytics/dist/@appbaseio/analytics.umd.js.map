{"version":3,"file":"analytics.umd.js","sources":["../../src/utils.js","../../node_modules/cross-fetch/dist/browser-ponyfill.js","../../src/validate.js","../../src/index.js"],"sourcesContent":["// Function to parse the URL\nexport function getURL(url: string): string {\n  return url && url.trim() !== '' ? url : 'https://scalr.api.appbase.io';\n}\n\nexport function btoa(input = '') {\n  const chars =\n    'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n  const str = input;\n  let output = '';\n\n  // eslint-disable-next-line\n  for (\n    let block = 0, charCode, i = 0, map = chars;\n    str.charAt(i | 0) || ((map = '='), i % 1); // eslint-disable-line no-bitwise\n    output += map.charAt(63 & (block >> (8 - (i % 1) * 8))) // eslint-disable-line no-bitwise\n  ) {\n    charCode = str.charCodeAt((i += 3 / 4));\n\n    if (charCode > 0xff) {\n      throw new Error(\n        '\"btoa\" failed: The string to be encoded contains characters outside of the Latin1 range.'\n      );\n    }\n\n    block = (block << 8) | charCode; // eslint-disable-line no-bitwise\n  }\n\n  return output;\n}\n","var global = typeof self !== 'undefined' ? self : this;\nvar __self__ = (function () {\nfunction F() {\nthis.fetch = false;\nthis.DOMException = global.DOMException\n}\nF.prototype = global;\nreturn new F();\n})();\n(function(self) {\n\nvar irrelevant = (function (exports) {\n\n  var support = {\n    searchParams: 'URLSearchParams' in self,\n    iterable: 'Symbol' in self && 'iterator' in Symbol,\n    blob:\n      'FileReader' in self &&\n      'Blob' in self &&\n      (function() {\n        try {\n          new Blob();\n          return true\n        } catch (e) {\n          return false\n        }\n      })(),\n    formData: 'FormData' in self,\n    arrayBuffer: 'ArrayBuffer' in self\n  };\n\n  function isDataView(obj) {\n    return obj && DataView.prototype.isPrototypeOf(obj)\n  }\n\n  if (support.arrayBuffer) {\n    var viewClasses = [\n      '[object Int8Array]',\n      '[object Uint8Array]',\n      '[object Uint8ClampedArray]',\n      '[object Int16Array]',\n      '[object Uint16Array]',\n      '[object Int32Array]',\n      '[object Uint32Array]',\n      '[object Float32Array]',\n      '[object Float64Array]'\n    ];\n\n    var isArrayBufferView =\n      ArrayBuffer.isView ||\n      function(obj) {\n        return obj && viewClasses.indexOf(Object.prototype.toString.call(obj)) > -1\n      };\n  }\n\n  function normalizeName(name) {\n    if (typeof name !== 'string') {\n      name = String(name);\n    }\n    if (/[^a-z0-9\\-#$%&'*+.^_`|~]/i.test(name)) {\n      throw new TypeError('Invalid character in header field name')\n    }\n    return name.toLowerCase()\n  }\n\n  function normalizeValue(value) {\n    if (typeof value !== 'string') {\n      value = String(value);\n    }\n    return value\n  }\n\n  // Build a destructive iterator for the value list\n  function iteratorFor(items) {\n    var iterator = {\n      next: function() {\n        var value = items.shift();\n        return {done: value === undefined, value: value}\n      }\n    };\n\n    if (support.iterable) {\n      iterator[Symbol.iterator] = function() {\n        return iterator\n      };\n    }\n\n    return iterator\n  }\n\n  function Headers(headers) {\n    this.map = {};\n\n    if (headers instanceof Headers) {\n      headers.forEach(function(value, name) {\n        this.append(name, value);\n      }, this);\n    } else if (Array.isArray(headers)) {\n      headers.forEach(function(header) {\n        this.append(header[0], header[1]);\n      }, this);\n    } else if (headers) {\n      Object.getOwnPropertyNames(headers).forEach(function(name) {\n        this.append(name, headers[name]);\n      }, this);\n    }\n  }\n\n  Headers.prototype.append = function(name, value) {\n    name = normalizeName(name);\n    value = normalizeValue(value);\n    var oldValue = this.map[name];\n    this.map[name] = oldValue ? oldValue + ', ' + value : value;\n  };\n\n  Headers.prototype['delete'] = function(name) {\n    delete this.map[normalizeName(name)];\n  };\n\n  Headers.prototype.get = function(name) {\n    name = normalizeName(name);\n    return this.has(name) ? this.map[name] : null\n  };\n\n  Headers.prototype.has = function(name) {\n    return this.map.hasOwnProperty(normalizeName(name))\n  };\n\n  Headers.prototype.set = function(name, value) {\n    this.map[normalizeName(name)] = normalizeValue(value);\n  };\n\n  Headers.prototype.forEach = function(callback, thisArg) {\n    for (var name in this.map) {\n      if (this.map.hasOwnProperty(name)) {\n        callback.call(thisArg, this.map[name], name, this);\n      }\n    }\n  };\n\n  Headers.prototype.keys = function() {\n    var items = [];\n    this.forEach(function(value, name) {\n      items.push(name);\n    });\n    return iteratorFor(items)\n  };\n\n  Headers.prototype.values = function() {\n    var items = [];\n    this.forEach(function(value) {\n      items.push(value);\n    });\n    return iteratorFor(items)\n  };\n\n  Headers.prototype.entries = function() {\n    var items = [];\n    this.forEach(function(value, name) {\n      items.push([name, value]);\n    });\n    return iteratorFor(items)\n  };\n\n  if (support.iterable) {\n    Headers.prototype[Symbol.iterator] = Headers.prototype.entries;\n  }\n\n  function consumed(body) {\n    if (body.bodyUsed) {\n      return Promise.reject(new TypeError('Already read'))\n    }\n    body.bodyUsed = true;\n  }\n\n  function fileReaderReady(reader) {\n    return new Promise(function(resolve, reject) {\n      reader.onload = function() {\n        resolve(reader.result);\n      };\n      reader.onerror = function() {\n        reject(reader.error);\n      };\n    })\n  }\n\n  function readBlobAsArrayBuffer(blob) {\n    var reader = new FileReader();\n    var promise = fileReaderReady(reader);\n    reader.readAsArrayBuffer(blob);\n    return promise\n  }\n\n  function readBlobAsText(blob) {\n    var reader = new FileReader();\n    var promise = fileReaderReady(reader);\n    reader.readAsText(blob);\n    return promise\n  }\n\n  function readArrayBufferAsText(buf) {\n    var view = new Uint8Array(buf);\n    var chars = new Array(view.length);\n\n    for (var i = 0; i < view.length; i++) {\n      chars[i] = String.fromCharCode(view[i]);\n    }\n    return chars.join('')\n  }\n\n  function bufferClone(buf) {\n    if (buf.slice) {\n      return buf.slice(0)\n    } else {\n      var view = new Uint8Array(buf.byteLength);\n      view.set(new Uint8Array(buf));\n      return view.buffer\n    }\n  }\n\n  function Body() {\n    this.bodyUsed = false;\n\n    this._initBody = function(body) {\n      this._bodyInit = body;\n      if (!body) {\n        this._bodyText = '';\n      } else if (typeof body === 'string') {\n        this._bodyText = body;\n      } else if (support.blob && Blob.prototype.isPrototypeOf(body)) {\n        this._bodyBlob = body;\n      } else if (support.formData && FormData.prototype.isPrototypeOf(body)) {\n        this._bodyFormData = body;\n      } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n        this._bodyText = body.toString();\n      } else if (support.arrayBuffer && support.blob && isDataView(body)) {\n        this._bodyArrayBuffer = bufferClone(body.buffer);\n        // IE 10-11 can't handle a DataView body.\n        this._bodyInit = new Blob([this._bodyArrayBuffer]);\n      } else if (support.arrayBuffer && (ArrayBuffer.prototype.isPrototypeOf(body) || isArrayBufferView(body))) {\n        this._bodyArrayBuffer = bufferClone(body);\n      } else {\n        this._bodyText = body = Object.prototype.toString.call(body);\n      }\n\n      if (!this.headers.get('content-type')) {\n        if (typeof body === 'string') {\n          this.headers.set('content-type', 'text/plain;charset=UTF-8');\n        } else if (this._bodyBlob && this._bodyBlob.type) {\n          this.headers.set('content-type', this._bodyBlob.type);\n        } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n          this.headers.set('content-type', 'application/x-www-form-urlencoded;charset=UTF-8');\n        }\n      }\n    };\n\n    if (support.blob) {\n      this.blob = function() {\n        var rejected = consumed(this);\n        if (rejected) {\n          return rejected\n        }\n\n        if (this._bodyBlob) {\n          return Promise.resolve(this._bodyBlob)\n        } else if (this._bodyArrayBuffer) {\n          return Promise.resolve(new Blob([this._bodyArrayBuffer]))\n        } else if (this._bodyFormData) {\n          throw new Error('could not read FormData body as blob')\n        } else {\n          return Promise.resolve(new Blob([this._bodyText]))\n        }\n      };\n\n      this.arrayBuffer = function() {\n        if (this._bodyArrayBuffer) {\n          return consumed(this) || Promise.resolve(this._bodyArrayBuffer)\n        } else {\n          return this.blob().then(readBlobAsArrayBuffer)\n        }\n      };\n    }\n\n    this.text = function() {\n      var rejected = consumed(this);\n      if (rejected) {\n        return rejected\n      }\n\n      if (this._bodyBlob) {\n        return readBlobAsText(this._bodyBlob)\n      } else if (this._bodyArrayBuffer) {\n        return Promise.resolve(readArrayBufferAsText(this._bodyArrayBuffer))\n      } else if (this._bodyFormData) {\n        throw new Error('could not read FormData body as text')\n      } else {\n        return Promise.resolve(this._bodyText)\n      }\n    };\n\n    if (support.formData) {\n      this.formData = function() {\n        return this.text().then(decode)\n      };\n    }\n\n    this.json = function() {\n      return this.text().then(JSON.parse)\n    };\n\n    return this\n  }\n\n  // HTTP methods whose capitalization should be normalized\n  var methods = ['DELETE', 'GET', 'HEAD', 'OPTIONS', 'POST', 'PUT'];\n\n  function normalizeMethod(method) {\n    var upcased = method.toUpperCase();\n    return methods.indexOf(upcased) > -1 ? upcased : method\n  }\n\n  function Request(input, options) {\n    options = options || {};\n    var body = options.body;\n\n    if (input instanceof Request) {\n      if (input.bodyUsed) {\n        throw new TypeError('Already read')\n      }\n      this.url = input.url;\n      this.credentials = input.credentials;\n      if (!options.headers) {\n        this.headers = new Headers(input.headers);\n      }\n      this.method = input.method;\n      this.mode = input.mode;\n      this.signal = input.signal;\n      if (!body && input._bodyInit != null) {\n        body = input._bodyInit;\n        input.bodyUsed = true;\n      }\n    } else {\n      this.url = String(input);\n    }\n\n    this.credentials = options.credentials || this.credentials || 'same-origin';\n    if (options.headers || !this.headers) {\n      this.headers = new Headers(options.headers);\n    }\n    this.method = normalizeMethod(options.method || this.method || 'GET');\n    this.mode = options.mode || this.mode || null;\n    this.signal = options.signal || this.signal;\n    this.referrer = null;\n\n    if ((this.method === 'GET' || this.method === 'HEAD') && body) {\n      throw new TypeError('Body not allowed for GET or HEAD requests')\n    }\n    this._initBody(body);\n  }\n\n  Request.prototype.clone = function() {\n    return new Request(this, {body: this._bodyInit})\n  };\n\n  function decode(body) {\n    var form = new FormData();\n    body\n      .trim()\n      .split('&')\n      .forEach(function(bytes) {\n        if (bytes) {\n          var split = bytes.split('=');\n          var name = split.shift().replace(/\\+/g, ' ');\n          var value = split.join('=').replace(/\\+/g, ' ');\n          form.append(decodeURIComponent(name), decodeURIComponent(value));\n        }\n      });\n    return form\n  }\n\n  function parseHeaders(rawHeaders) {\n    var headers = new Headers();\n    // Replace instances of \\r\\n and \\n followed by at least one space or horizontal tab with a space\n    // https://tools.ietf.org/html/rfc7230#section-3.2\n    var preProcessedHeaders = rawHeaders.replace(/\\r?\\n[\\t ]+/g, ' ');\n    preProcessedHeaders.split(/\\r?\\n/).forEach(function(line) {\n      var parts = line.split(':');\n      var key = parts.shift().trim();\n      if (key) {\n        var value = parts.join(':').trim();\n        headers.append(key, value);\n      }\n    });\n    return headers\n  }\n\n  Body.call(Request.prototype);\n\n  function Response(bodyInit, options) {\n    if (!options) {\n      options = {};\n    }\n\n    this.type = 'default';\n    this.status = options.status === undefined ? 200 : options.status;\n    this.ok = this.status >= 200 && this.status < 300;\n    this.statusText = 'statusText' in options ? options.statusText : 'OK';\n    this.headers = new Headers(options.headers);\n    this.url = options.url || '';\n    this._initBody(bodyInit);\n  }\n\n  Body.call(Response.prototype);\n\n  Response.prototype.clone = function() {\n    return new Response(this._bodyInit, {\n      status: this.status,\n      statusText: this.statusText,\n      headers: new Headers(this.headers),\n      url: this.url\n    })\n  };\n\n  Response.error = function() {\n    var response = new Response(null, {status: 0, statusText: ''});\n    response.type = 'error';\n    return response\n  };\n\n  var redirectStatuses = [301, 302, 303, 307, 308];\n\n  Response.redirect = function(url, status) {\n    if (redirectStatuses.indexOf(status) === -1) {\n      throw new RangeError('Invalid status code')\n    }\n\n    return new Response(null, {status: status, headers: {location: url}})\n  };\n\n  exports.DOMException = self.DOMException;\n  try {\n    new exports.DOMException();\n  } catch (err) {\n    exports.DOMException = function(message, name) {\n      this.message = message;\n      this.name = name;\n      var error = Error(message);\n      this.stack = error.stack;\n    };\n    exports.DOMException.prototype = Object.create(Error.prototype);\n    exports.DOMException.prototype.constructor = exports.DOMException;\n  }\n\n  function fetch(input, init) {\n    return new Promise(function(resolve, reject) {\n      var request = new Request(input, init);\n\n      if (request.signal && request.signal.aborted) {\n        return reject(new exports.DOMException('Aborted', 'AbortError'))\n      }\n\n      var xhr = new XMLHttpRequest();\n\n      function abortXhr() {\n        xhr.abort();\n      }\n\n      xhr.onload = function() {\n        var options = {\n          status: xhr.status,\n          statusText: xhr.statusText,\n          headers: parseHeaders(xhr.getAllResponseHeaders() || '')\n        };\n        options.url = 'responseURL' in xhr ? xhr.responseURL : options.headers.get('X-Request-URL');\n        var body = 'response' in xhr ? xhr.response : xhr.responseText;\n        resolve(new Response(body, options));\n      };\n\n      xhr.onerror = function() {\n        reject(new TypeError('Network request failed'));\n      };\n\n      xhr.ontimeout = function() {\n        reject(new TypeError('Network request failed'));\n      };\n\n      xhr.onabort = function() {\n        reject(new exports.DOMException('Aborted', 'AbortError'));\n      };\n\n      xhr.open(request.method, request.url, true);\n\n      if (request.credentials === 'include') {\n        xhr.withCredentials = true;\n      } else if (request.credentials === 'omit') {\n        xhr.withCredentials = false;\n      }\n\n      if ('responseType' in xhr && support.blob) {\n        xhr.responseType = 'blob';\n      }\n\n      request.headers.forEach(function(value, name) {\n        xhr.setRequestHeader(name, value);\n      });\n\n      if (request.signal) {\n        request.signal.addEventListener('abort', abortXhr);\n\n        xhr.onreadystatechange = function() {\n          // DONE (success or failure)\n          if (xhr.readyState === 4) {\n            request.signal.removeEventListener('abort', abortXhr);\n          }\n        };\n      }\n\n      xhr.send(typeof request._bodyInit === 'undefined' ? null : request._bodyInit);\n    })\n  }\n\n  fetch.polyfill = true;\n\n  if (!self.fetch) {\n    self.fetch = fetch;\n    self.Headers = Headers;\n    self.Request = Request;\n    self.Response = Response;\n  }\n\n  exports.Headers = Headers;\n  exports.Request = Request;\n  exports.Response = Response;\n  exports.fetch = fetch;\n\n  Object.defineProperty(exports, '__esModule', { value: true });\n\n  return exports;\n\n})({});\n})(__self__);\n__self__.fetch.ponyfill = true;\n// Remove \"polyfill\" property added by whatwg-fetch\ndelete __self__.fetch.polyfill;\n// Choose between native implementation (global) or custom implementation (__self__)\n// var ctx = global.fetch ? global : __self__;\nvar ctx = __self__; // this line disable service worker support temporarily\nexports = ctx.fetch // To enable: import fetch from 'cross-fetch'\nexports.default = ctx.fetch // For TypeScript consumers without esModuleInterop.\nexports.fetch = ctx.fetch // To enable: import {fetch} from 'cross-fetch'\nexports.Headers = ctx.Headers\nexports.Request = ctx.Request\nexports.Response = ctx.Response\nmodule.exports = exports\n","export function validateIndex(index: string) {\n  if (!index) {\n    throw new Error(\n      'appbase-analytics: A valid index must be present to record analytics events.'\n    );\n  }\n}\n\nexport function validateCredentials(credentials: string) {\n  if (!credentials) {\n    throw new Error('appbase-analytics: Auth credentials is missing.');\n  }\n}\n\nexport function validateURL(url: string) {\n  if (!url) {\n    throw new Error('appbase-analytics: URL is missing.');\n  }\n}\n\nexport function validateSearchQuery(query: string) {\n  if (query === undefined || query === null) {\n    throw new Error(\n      'appbase-analytics: query must be present, set to empty string to register as an empty query search.'\n    );\n  }\n}\n\nexport function validateQuery(query: string, queryID: string) {\n  if ((query === undefined || query === null) && !queryID) {\n    throw new Error(\n      'appbase-analytics: query or queryID must be present to register a click/conversion event'\n    );\n  }\n}\n\nexport function validateQueryID(queryID: string) {\n  if (!queryID) {\n    throw new Error(\n      'appbase-analytics: queryID must be present to save search/favorite'\n    );\n  }\n}\n\nexport function validateClickObjects(objects: Object) {\n  if (!objects || Object.keys(objects).length < 1) {\n    throw new Error(\n      'appbase-analytics: at least one click object must be present to register a click event'\n    );\n  }\n}\n\nexport function validateConversionObjects(objects: Object) {\n  if (!objects || Object.keys(objects).length < 1) {\n    throw new Error(\n      'appbase-analytics: at least one click object must be present to register a click event'\n    );\n  }\n}\n","// @flow\nimport { btoa } from './utils';\nimport fetch from 'cross-fetch';\nimport {\n  validateIndex,\n  validateCredentials,\n  validateURL,\n  validateQuery,\n  validateClickObjects,\n  validateConversionObjects,\n  validateQueryID\n} from './validate';\n\ntype Hit = {\n  id?: string,\n  type?: string,\n  source?: Object\n};\n\ntype Impression = {\n  id: string,\n  index: 'good-books-ds'\n};\n\ntype AnalyticsConfig = {\n  index: string,\n  url: string,\n  credentials: string,\n  userID?: string,\n  globalCustomEvents?: { [key: string]: string },\n  headers?: Object\n};\n\ntype SearchConfig = {\n  query?: string,\n  queryID?: string,\n  customEvents?: { [key: string]: string },\n  filters?: { [key: string]: string },\n  hits?: Array<Hit>,\n  impressions?: Array<Impression>\n};\n\ntype SearchRequestBody = {\n  query?: string,\n  query_id?: string,\n  custom_events?: { [key: string]: string },\n  filters?: { [key: string]: string },\n  user_id?: string,\n  hits?: Array<Hit>\n};\n\ntype ClickConfig = {\n  query?: string,\n  queryID?: string,\n  isSuggestionClick?: boolean,\n  objects: { [key: string]: number },\n  customEvents?: { [key: string]: string },\n  meta?: Object\n};\n\ntype ClickRequestBody = {\n  click_on: { [key: string]: number },\n  click_type?: 'result' | 'suggestion',\n  query?: string,\n  query_id?: string,\n  custom_events?: { [key: string]: string },\n  user_id?: string,\n  meta?: Object\n};\n\ntype ConversionConfig = {\n  objects: Array<string>,\n  queryID?: string,\n  meta?: Object\n};\n\ntype SaveSearchConfig = {\n  queryID: string,\n  saveSearchID?: string,\n  saveSearchMeta?: Object,\n  userID?: string,\n  customEvents?: { [key: string]: string }\n};\n\ntype SaveSearchRequestBody = {\n  query_id: string,\n  save_search_id?: string,\n  save_search_meta?: Object,\n  user_id?: string,\n  custom_events?: { [key: string]: string }\n};\n\ntype FavoriteConfigRequest = {\n  favorite_on: string,\n  source: Object,\n  query_id: string,\n  id?: string,\n  custom_events?: { [key: string]: string },\n  user_id?: string,\n  meta?: Object\n};\n\ntype FavoriteConfig = {\n  favoriteOn: string,\n  source: Object,\n  queryID: string,\n  id?: string,\n  customEvents?: { [key: string]: string },\n  userID?: string,\n  meta?: Object\n};\n\ntype ConversionRequestBody = {\n  conversion_on: Array<string>,\n  query_id?: string,\n  meta?: Object\n};\n\ntype CallBack = (err: any, res: any) => void;\n\ntype Metrics = {\n  index: string,\n  url: string,\n  credentials: string,\n  globalCustomEvents?: { [key: string]: string },\n  userID?: string,\n  queryID: string,\n  headers?: Object,\n  search?: (searchConfig: SearchConfig, callback: CallBack) => void,\n  click?: (clickConfig: ClickConfig, callback: CallBack) => void,\n  conversion?: (conversionConfig: ConversionConfig, callback: CallBack) => void,\n  // To save search\n  saveSearch?: (saveSearchConfig: SaveSearchConfig, callback: CallBack) => void,\n  // To delete saved search\n  deleteSavedSearch?: (saveSearchId: string, callback: CallBack) => void,\n  // To retrieve saved searches\n  getSavedSearches?: (filters?: Object, callback: CallBack) => void,\n  // To record a favorite document\n  favorite?: (favoriteConfig: FavoriteConfig, callback: CallBack) => void,\n  // To retrieve favorites\n  getFavorites?: (filters?: Object, callback: CallBack) => void,\n  getQueryID?: () => string,\n  setUserID?: (userID: string) => void,\n  setGlobalCustomEvents?: (events: { [key: string]: string }) => void,\n  setHeaders?: (headers: Object) => void,\n  _request: (\n    method: string,\n    url: string,\n    body?: Object,\n    queryParams?: Object,\n    callback?: CallBack\n  ) => void\n};\n\nfunction initClient(config: AnalyticsConfig = {}) {\n  const metrics: Metrics = {\n    credentials: config.credentials,\n    index: config.index,\n    url: config.url,\n    userID: config.userID,\n    globalCustomEvents: config.globalCustomEvents,\n    queryID: '',\n    headers: null,\n    _request: (\n      method: string,\n      url: string,\n      body?: Object,\n      queryParams?: Object,\n      callback?: CallBack\n    ): void => {\n      const finalBody = {\n        user_id: metrics.userID,\n        ...body,\n        custom_events: {\n          ...(body && body.custom_events),\n          ...metrics.globalCustomEvents\n        }\n      };\n      let queryParamsString = '';\n      if (queryParams) {\n        queryParamsString = Object.keys(queryParams)\n          .map(param => `${param}=${queryParams[param]}`)\n          .join('&');\n      }\n      return fetch(`${metrics.url}/${url}?${queryParamsString}`, {\n        method: method,\n        headers: {\n          ...metrics.headers,\n          'Content-Type': 'application/json',\n          Authorization: `Basic ${btoa(metrics.credentials)}`\n        },\n        body: method === 'GET' ? null : JSON.stringify(finalBody)\n      })\n        .then(response => {\n          if (callback) {\n            callback(null, response);\n          }\n        })\n        .catch(err => {\n          if (callback) {\n            callback(err, null);\n          }\n        });\n    }\n  };\n\n  validateIndex(metrics.index);\n  validateCredentials(metrics.credentials);\n  validateURL(metrics.url);\n\n  // To register a search\n  metrics.search = (searchConfig: SearchConfig, callback?: CallBack) => {\n    validateQuery(searchConfig.query, searchConfig.queryID);\n    const captureQueryID = (err: any, res: any) => {\n      if (res) {\n        res\n          .json()\n          .then(response => {\n            if (response && response.query_id) {\n              metrics.queryID = response.query_id;\n            }\n            if (callback) {\n              callback(err, res);\n            }\n          })\n          .catch(err2 => {\n            if (callback) {\n              callback(err2, res);\n            }\n          });\n      } else if (callback) {\n        callback(err, res);\n      }\n    };\n    // just to avoid the flow type error\n    if (metrics._request) {\n      const requestBody: SearchRequestBody = {\n        query: searchConfig.query,\n        query_id: searchConfig.queryID,\n        custom_events: searchConfig.customEvents,\n        filters: searchConfig.filters,\n        hits: searchConfig.hits,\n        impressions: searchConfig.impressions\n      };\n      metrics._request(\n        'PUT',\n        `${metrics.index}/_analytics/search`,\n        requestBody,\n        null,\n        captureQueryID\n      );\n    }\n  };\n\n  // To register a click\n  metrics.click = (clickConfig: ClickConfig, callback?: CallBack) => {\n    validateQuery(clickConfig.query, clickConfig.queryID);\n    validateClickObjects(clickConfig.objects);\n    // just to avoid the flow type error\n    if (metrics._request) {\n      const requestBody: ClickRequestBody = {\n        click_on: clickConfig.objects,\n        click_type: clickConfig.isSuggestionClick ? 'suggestion' : 'result',\n        query: clickConfig.query,\n        query_id: clickConfig.queryID,\n        custom_events: clickConfig.customEvents,\n        meta: clickConfig.meta\n      };\n      metrics._request(\n        'PUT',\n        `${metrics.index}/_analytics/click`,\n        requestBody,\n        null,\n        callback\n      );\n    }\n  };\n\n  // To register a conversion\n  metrics.conversion = (\n    conversionConfig: ConversionConfig,\n    callback?: CallBack\n  ) => {\n    validateQuery(null, conversionConfig.queryID);\n    validateConversionObjects(conversionConfig.objects);\n    // just to avoid the flow type error\n    if (metrics._request) {\n      const requestBody: ConversionRequestBody = {\n        conversion_on: conversionConfig.objects,\n        query_id: conversionConfig.queryID,\n        meta: conversionConfig.meta\n      };\n      metrics._request(\n        'PUT',\n        `${metrics.index}/_analytics/conversion`,\n        requestBody,\n        null,\n        callback\n      );\n    }\n  };\n\n  // To save search\n  metrics.saveSearch = (\n    saveSearchConfig: SaveSearchConfig,\n    callback?: CallBack\n  ) => {\n    validateQueryID(saveSearchConfig.queryID);\n    const requestBody: SaveSearchRequestBody = {\n      query_id: saveSearchConfig.queryID,\n      save_search_id: saveSearchConfig.saveSearchID,\n      save_search_meta: saveSearchConfig.saveSearchMeta,\n      user_id: saveSearchConfig.userID,\n      custom_events: saveSearchConfig.customEvents\n    };\n    metrics._request(\n      'PUT',\n      '_analytics/save-search',\n      requestBody,\n      null,\n      callback\n    );\n  };\n\n  // To delete save search\n  metrics.deleteSavedSearch = (saveSearchId: string, callback?: CallBack) => {\n    metrics._request(\n      'DELETE',\n      '_analytics/save-search/' + saveSearchId,\n      null,\n      null,\n      callback\n    );\n  };\n\n  // To retrieve saved searches\n  metrics.getSavedSearches = (filters?: Object, callback?: CallBack) => {\n    // just to avoid the flow type error\n    if (metrics._request) {\n      metrics._request(\n        'GET',\n        '_analytics/saved-searches',\n        null,\n        filters,\n        callback\n      );\n    }\n  };\n\n  // To record a favorite document\n  metrics.favorite = (favoriteConfig: FavoriteConfig, callback?: CallBack) => {\n    validateQueryID(favoriteConfig.queryID);\n    if (!favoriteConfig.favoriteOn || favoriteConfig.favoriteOn === '') {\n      throw new Error('appbase-analytics: favoriteOn property is required');\n    }\n    if (!favoriteConfig.source) {\n      throw new Error('appbase-analytics: source property is required');\n    }\n    const requestBody: FavoriteConfigRequest = {\n      query_id: favoriteConfig.queryID,\n      favorite_on: favoriteConfig.favoriteOn,\n      source: favoriteConfig.source,\n      id: favoriteConfig.id,\n      meta: favoriteConfig.meta,\n      user_id: favoriteConfig.userID,\n      custom_events: favoriteConfig.customEvents\n    };\n    metrics._request('PUT', '_analytics/favorite', requestBody, null, callback);\n  };\n\n  // To retrieve favorites\n  metrics.getFavorites = (filters?: Object, callback?: CallBack) => {\n    // just to avoid the flow type error\n    if (metrics._request) {\n      metrics._request('GET', '_analytics/favorites', null, filters, callback);\n    }\n  };\n\n  // Sets the userID\n  metrics.setUserID = (userID: string) => {\n    metrics.userID = userID;\n  };\n\n  // Sets the global events\n  metrics.setGlobalCustomEvents = (globalEvents: { [key: string]: string }) => {\n    metrics.globalCustomEvents = globalEvents;\n  };\n\n  // Sets the headers\n  metrics.setHeaders = (headers: Object) => {\n    metrics.headers = headers;\n  };\n\n  // get queryID\n  metrics.getQueryID = () => metrics.queryID;\n\n  return metrics;\n}\n\nexport default {\n  init: initClient\n};\n"],"names":["btoa","input","chars","str","output","block","charCode","i","map","charAt","charCodeAt","Error","this","validateIndex","index","validateCredentials","credentials","validateURL","url","validateQuery","query","queryID","undefined","validateQueryID","validateClickObjects","objects","Object","keys","length","validateConversionObjects","initClient","config","metrics","userID","globalCustomEvents","headers","_request","method","body","queryParams","callback","finalBody","user_id","custom_events","queryParamsString","param","join","fetch","Authorization","JSON","stringify","then","response","err","search","searchConfig","captureQueryID","res","json","query_id","err2","requestBody","customEvents","filters","hits","impressions","click","clickConfig","click_on","click_type","isSuggestionClick","meta","conversion","conversionConfig","conversion_on","saveSearch","saveSearchConfig","save_search_id","saveSearchID","save_search_meta","saveSearchMeta","deleteSavedSearch","saveSearchId","getSavedSearches","favorite","favoriteConfig","favoriteOn","source","favorite_on","id","getFavorites","setUserID","setGlobalCustomEvents","globalEvents","setHeaders","getQueryID","init"],"mappings":"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"}